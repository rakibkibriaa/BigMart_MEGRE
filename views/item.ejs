<html>

<head>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


    <title>
        BigMart
    </title>

<body>


    <nav class="navbar sticky-top navbar-light bg-light navbar-expand-lg" >
            <div class="container-fluid" id = 'nav'>
                <a class="navbar-brand">
                    
                    <form action="/logged_in" method="POST">
                        
                        <input type="hidden" name="category" value="" />
                        <input type="hidden" name="user_info" value=<%=JSON.stringify(user) %> />
                        <button class="btn btn-info bg-dark" type="submit">
                            <h1>BigMart</h1>
                        </button>
                    </form>
                    
                </a>

                <form class="d-flex" action="/search" method="POST">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" name="tag">
                    <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
                
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    
                    <li class="nav-item pr-4">
                       
                            <form action="/my_review" method="POST">
                                <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />
                                <a class="nav-link active" href="#">
                                    <button type="submit">
                                        My Review
                                    </button>
                                </a>
                            </form>
                       
                    </li>
                    <li class="nav-item pr-4">
                       
                            <form action="/wishlist" method="POST">
                                <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />
                                <a class="nav-link active" href="#">
                                    <button type="submit">
                                        My Wishlist
                                    </button>
                                </a>
                            </form>
                       
                    </li>
                    <li class="nav-item pr-4">
                       
                            <form action="/subscribe" method="POST">
                                <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />
                                <a class="nav-link active" href="#">
                                    <button type="submit">
                                        Subscribe
                                    </button>
                                </a>
                            </form>
                       
                    </li>
                    <li class="nav-item pr-4">
                       
                            <form action="/clicked_cart" method="POST">
                                <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />
                                <a class="nav-link active" href="#">
                                    <button type="submit">
                                        Cart
                                    </button>
                                </a>
                            </form>
                       
                    </li>

                   
                    <li class="nav-item pr-4">
                        <form action="/profile" method="POST">
                            <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />
                            <a class="nav-link active" href="#">
                                <button type="submit">
                                    Profile
                                </button>
                            </a>
                        </form>
                    
                    </li>
                    <li class="nav-item">
                        <form action="/logout" method="POST">
                            <a class="nav-link active" href="#">
                                <button type="submit">
                                    Log out
                                </button>
                            </a>
                        </form>
                    </li>
                </ul>
                
            </div>
          
        </nav>


    

        <div class="d-flex justify-content-center">

            <div class="card mb-3 mt-5 " style="max-width: 800px">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="/img/product_default.png" class="img-fluid rounded-start" alt="">
                    </div> 
                    
           
                    
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title font-weight-bold">Name: <%= value.NAME %></h5>
                            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional
                            </p>
                            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional
                            </p>
                            <p class="card-text font-weight-bold ">In stock: <%= value.QUANTITY%></p>
                            <p class="card-text font-weight-bold ">Price : <%= value.PRICE %>
                            </p>
                            
                            
                            <div>
                                <form action="/search" method="POST">
                                    <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />

                                    <input type="hidden" name="tag" value=<%= value.CATEGORY %> />
                                    <p class = "d-inline  card-text font-weight-bold">Category</p>
                                    <button class="d-inline btn btn-outline-primary ml-3" name='butt' value='3' type="submit"><%= value.CATEGORY %></button>
                                </form>
                            </div>
                            <div>
                                <form action="/seller_category_buyer" method="POST">
                                    <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />

                                    <input type="hidden" name="tag" value=<%= value.CATEGORY %> />
                                    <input type="hidden" name="seller_name" value=<%= seller.NAME %> />
                                    <p class = "d-inline  card-text font-weight-bold">Seller Name:</p>
                                    <button class="d-inline btn btn-outline-primary ml-3" name='butt' value='3' type="submit"><%= seller.NAME %></button>
                                </form>
                            </div>
                            <div>
                                <form action="/item/cart" method="POST">

                                    <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />

                                    <input type="hidden" name='product' value=<%=JSON.stringify(value) %> />
                                    <input type="hidden" name='product_id' value=<%=value.PRODUCT_ID %> />
                                    <div class="mb-4">
                                    
                                        <p class="d-inline  card-text font-weight-bold"> Quantity:</p>
                                        <input type= "number" min ="1" class="d-inline ml-2 col-lg-2 form-control" name="quantity" required>
                                    
                                    </div>
                                    <div class="mb-4">
                                    <% if(avgRating == null){ %>
                                        <p class="d-inline  card-text font-weight-bold"> No Rating Found</p>
                                    <% 
                                    } 
                                    else
                                    { %>  
                                        <p class="d-inline  card-text font-weight-bold"> Rating: <%= avgRating.AVG %></p>
                                     <% 
                                    } 
                                    %>
                                    </div>
                                    <button class="btn btn-outline-primary  mt-5" name='butt' value='1' type="submit" >Add to Cart</button>
                                    <button class="btn btn-outline-success mt-5 ml-5" name="butt" value='2' type="submit">Add to Wishlist</button>
                                    
                                </form>
                                <div class="d-flex justify-content">
                                    <form action="/complain" method="POST">
                                    <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />
                                    <input type="hidden" name='product' value=<%=JSON.stringify(value) %> />
                                    <input type="hidden" name='product_id' value=<%=value.PRODUCT_ID %> />
                                    <input type="hidden" name="seller_name" value= <%= seller.NAME %> />
                                        <button class="btn btn-outline-danger mt-5 ml-5" name="butt" value='3' type="submit">Complain</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            

        </div>

        <% if(canReview > 0 && totalReview.COUNT == 0)
        { 
            %>
        <div class="d-flex justify-content-center">

            <h1>Write a Review</h1>

            

        </div>

        <form action="/review" method="POST">

            <input type="hidden" name='user_info' value=<%=JSON.stringify(user) %> />

            <input type="hidden" name="tag" value=<%= value.CATEGORY %> />
            
            <input type="hidden" name='product_id' value=<%=value.PRODUCT_ID %> />
            
            <div class="d-flex justify-content-center mt-3">

                <select name="rating" , id="type">
                    <option value="5">5 Star</option>
                    <option value="4">4 Star</option>
                    <option value="3">3 Star</option>
                    <option value="2">2 Star</option>
                    <option value="1">1 Star</option>
                
                </select>
            </div>
            <div class="d-flex justify-content-center mt-4">
                <input type="text" name="review_msg" id="" placeholder="Add your experience" />
                
            </div>

            <div class="d-flex justify-content-center">

            
                    <button class="btn btn-outline-primary mt-3 mb-5" name='butt' value='1' type="submit" >Submit</button>
            
            </div>
        </form>
        <% 
        } 
        else
        { 
            %>  <div class="d-flex justify-content-center mt-4 mb-3">
                    <h1>You can only Review 'once' after the product is delivered!</h1>
                </div>
            <% 
        } 
        %>
       

        <% if(reviews.length > 0){ %>
        <div class="d-flex justify-content-center">

            <h1>Reviews</h1>

        </div>

         <% for(var i=0; i < reviews.length;i++) {%>
             <div class="d-flex justify-content-center mt-4">     
                <div class="card mb-4" style="width: 70rem">
                    <div class="card-body">
                        <h5 class="card-title"><%= reviews[i].RATING %> &#9733</h5>
                        
                        <p class="card-text"><%= reviews[i].MSG %> </p>
                        <p class="card-link"> - <%= reviews[i].NAME %></p>

                        <% if(reviews[i].PERSON_ID == user.person_id){ %>

                            <form action="/edit_review" method="POST">

                                <input type="hidden" name='user_info' value=<%= JSON.stringify(user) %> />

                                
                                <input type="hidden" name='review_id' value=<%= reviews[i].REVIEW_ID %> />
                                
                                <input type="hidden" name='product_id' value=<%= value.PRODUCT_ID %> />

                                <div class="d-flex justify-content-center">

                                    <button class="btn btn-outline-primary mt-3 mb-5" name='butt' value='1' type="submit" >Edit Review</button>
                                    <button class="btn btn-outline-danger ml-4 mt-3 mb-5" name='butt' value='2' type="submit" >Delete Review</button>
                
                                </div>

                            </form>

                        <% } %>
                        
                    </div>
                </div>
            </div> 
        <%} %>
        <% } %>
        

       
         
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>

    <script>

      

    </script>
</body>


</head>

</html>